layui.config({
	base:ctx+'/static/src/js/'		
}).use(['navtab','navbar'],function(){
	var $ = layui.jquery,
    layer = layui.layer;
	_doc = $(document),
	element = layui.element,
    navtab = layui.navtab({
		elem: '.larry-tab-box'
	});
	
	//iframe自适应
	$(window).on('resize', function() {
		var $content = $('#larry-tab .layui-tab-content');
		$content.height($(this).height()-160);
		$content.width($(this).width());
	    $content.find('iframe').each(function() {
	    	$(this).height($content.height());
	    });
	}).resize();
	
	
	$(function(){
		$("#larry-nav-side").click(function(){
			if ($(this).attr("lay-filter")!=undefined) {
				$(this).children('ul').find('li').each(function(){
					var $this = $(this);
					if($this.find('dl').length > 0){
						var $dd = $this.find('dd').each(function(){
	                       $(this).on('click', function() {
	                           var $a = $(this).children('a');
	                           var href = $a.data('url');
	                           var icon = $a.children('i:first').data('icon');
	                           var title = $a.children('span').text();
	                           var data = {
	                                 href: href,
	                                 icon: icon,
	                                 title: title
	                           }
	                           navtab.tabAdd(data);
	                       });
	                    });
					}else{
						$this.on('click', function() {
                           var $a = $(this).children('a');
                           var href = $a.data('url');
                           var icon = $a.children('i:first').data('icon');
                           var title = $a.children('span').text();
                           var data = {
                               href: href,
                               icon: icon,
                               title: title
                           }
                           navtab.tabAdd(data);
	                    });
					}
				})
			}
		})
	})
})

layui.use(['jquery','layer','element'],function(){
	window.jQuery = window.$ = layui.jquery;
	window.layer = layui.layer;
	initMenu();
	
	// larry-side-menu向左折叠
	$('.kit-side-fold').off('click').on('click',function() {
		var _side = _doc.find('div.kit-side');
		if(_side.hasClass('kit-sided')){
			_side.removeClass('kit-sided');
			_doc.find('em.layui-nav-more').css('display','block');
			_doc.find('div.layui-body').removeClass('kit-body-folded');
	        _doc.find('div.layui-footer').removeClass('kit-footer-folded');
		}else{
			_side.addClass('kit-sided');
			_doc.find('em.layui-nav-more').css('display','none');
	        _doc.find('div.layui-body').addClass('kit-body-folded');
	        _doc.find('div.layui-footer').addClass('kit-footer-folded');
		}
	})
	
})

function initMenu(){
	var element = layui.element;
	//左侧菜单栏处理
	var menuList = document.getElementById("menuList").innerText;
	var parsedJson = jQuery.parseJSON(menuList);
	var html = "";
	for (var i=0;i<parsedJson.length;i++ ){
		var menu = parsedJson[i];
		html += '<li class="layui-nav-item">';
		if (menu.parentId=='0') {//目录
			var icon = menu.icon;
			var name = menu.name;
			var id = menu.id;
			html += '<a href="javascript:;"';
			html += '<i class="'+icon+'"></i>';
			html += '<span>'+name+'</span>';
			html += '<em class="layui-nav-more"></em>';
			html += '</a>';
			//子菜单
			for(var j=0;j<parsedJson.length;j++){
				var childMenu = parsedJson[j];
				if(childMenu.parentId==id){
					var icon = childMenu.icon;
					var name = childMenu.name;
					var url = childMenu.url;
					if(childMenu.type=='menu'){
						html += '<dl class="layui-nav-child">';
						html += '<dd>';
						html += '<a href="javasctipt:;" data-url="'+ctx+url+'">';
						html += '<i class="'+icon+'" data-icon="'+icon+'"></i>';
						html += '<span>'+name+'</span>';
						html += '</a>';
						html += '<dd>';
						html += '</dl>'
					}
				}
			}
		}
		html += '</li>'
	}
	$("#menuTree").append(html);
	element.init();  //初始化页面元素
}